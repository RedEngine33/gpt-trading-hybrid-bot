//@version=5
indicator("TVâ†’Webhook JSON (Option2)", overlay=true)

tf  = input.timeframe("15", "TF")
ema9  = ta.ema(close, 9)
ema20 = ta.ema(close, 20)
rsi = ta.rsi(close, 14)
atr = ta.atr(14)

strong_long  = ema9 > ema20 and rsi > 55
strong_short = ema9 < ema20 and rsi < 45
setup = strong_long ? "strong_long" : strong_short ? "strong_short" : "neutral"

entry_min = close
entry_max = close
sl  = strong_long ? close - atr : strong_short ? close + atr : na
tp1 = strong_long ? close + atr*1.2 : strong_short ? close - atr*1.2 : na
tp2 = strong_long ? close + atr*2.0 : strong_short ? close - atr*2.0 : na
rr  = 1.6

payload = '{"secret":"abc123!@#", "symbol":"%s", "metrics":{"tf":"%s","setup":"%s","close":%f,"ema9":%f,"ema20":%f,"rsi":%f,"atr":%f,"entry_min":%f,"entry_max":%f,"sl":%f,"tp1":%f,"tp2":%f,"rr":%f}}'
alert_message = str.format(payload, syminfo.ticker, tf, setup, close, ema9, ema20, rsi, atr, entry_min, entry_max, sl, tp1, tp2, rr)

alertcondition(true, title="Send JSON", message=alert_message)
